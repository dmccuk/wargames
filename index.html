<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#0a0a0a" />
  <title>WARGAMES - WOPR SYSTEM</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root{
      --phosphor:#33ff33;
      --phosphor-soft:#2fe12f;
      --grid:#2fa62f;
      --bg:#0a0a0a;
      --warn:#ffff33;
      --error:#ff3333;
    }
    body {
      background: var(--bg);
      font-family: 'VT323', monospace;
      color: var(--phosphor);
      overflow: hidden;
      font-size: 18px;
      text-shadow: 0 0 3px var(--phosphor);
    }

    .scanlines {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: repeating-linear-gradient(
        0deg,
        rgba(0, 0, 0, 0.15),
        rgba(0, 0, 0, 0.15) 1px,
        transparent 1px,
        transparent 2px
      );
      pointer-events: none;
      z-index: 1000;
      animation: scan 8s linear infinite;
    }

    @keyframes scan {
      0% { transform: translateY(0); }
      100% { transform: translateY(10px); }
    }

    .screen {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
    }

    .screen.active {
      display: flex;
      flex-direction: column;
    }

    /* Title Screen */
    #title-screen {
      justify-content: center;
      align-items: center;
      text-align: center;
    }

    .title-logo {
      font-size: 72px;
      letter-spacing: 10px;
      text-shadow: 0 0 20px var(--phosphor), 0 0 40px var(--phosphor);
      margin-bottom: 40px;
      animation: glow-pulse 2s infinite;
    }

    @keyframes glow-pulse {
      0%, 100% { text-shadow: 0 0 20px var(--phosphor), 0 0 40px var(--phosphor); }
      50% { text-shadow: 0 0 30px var(--phosphor), 0 0 60px var(--phosphor); }
    }

    .subtitle {
      font-size: 28px;
      margin-bottom: 60px;
      color: var(--warn);
      text-shadow: 0 0 10px var(--warn);
    }

    .start-button {
      font-family: 'VT323', monospace;
      font-size: 32px;
      background: transparent;
      border: 3px solid var(--phosphor);
      color: var(--phosphor);
      padding: 15px 60px;
      cursor: pointer;
      text-shadow: 0 0 10px var(--phosphor);
      box-shadow: 0 0 20px rgba(51, 255, 51, 0.3);
      transition: all 0.3s;
    }

    .start-button:hover {
      background: var(--phosphor);
      color: var(--bg);
      text-shadow: none;
      box-shadow: 0 0 30px var(--phosphor);
    }

    /* Game Screens */
    .game-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 20px;
    }

    .game-header {
      background: rgba(10, 10, 10, 0.95);
      border: 2px solid var(--phosphor);
      padding: 15px 25px;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 22px;
      text-shadow: 0 0 8px var(--phosphor);
    }

    .level-title {
      font-size: 28px;
      letter-spacing: 3px;
    }

    .score-display {
      display: flex;
      gap: 40px;
    }

    .game-content {
      flex: 1;
      border: 2px solid var(--phosphor);
      background: rgba(10, 10, 10, 0.9);
      padding: 30px;
      overflow-y: auto;
      box-shadow: inset 0 0 30px rgba(51, 255, 51, 0.1);
    }

    .terminal-text {
      font-size: 20px;
      line-height: 1.6;
      margin: 10px 0;
      text-shadow: 0 0 5px var(--phosphor);
    }

    .cipher-text {
      color: var(--warn);
      text-shadow: 0 0 8px var(--warn);
      font-size: 24px;
      letter-spacing: 3px;
      margin: 20px 0;
      padding: 20px;
      border: 1px solid var(--warn);
      background: rgba(255, 255, 51, 0.05);
    }

    .input-group {
      margin: 30px 0;
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .input-label {
      font-size: 22px;
      text-shadow: 0 0 5px var(--phosphor);
    }

    .game-input {
      flex: 1;
      background: transparent;
      border: 2px solid var(--phosphor);
      color: var(--phosphor);
      font-family: 'VT323', monospace;
      font-size: 24px;
      padding: 10px 15px;
      text-shadow: 0 0 5px var(--phosphor);
      outline: none;
      letter-spacing: 2px;
      text-transform: uppercase;
    }

    .submit-btn {
      font-family: 'VT323', monospace;
      font-size: 24px;
      background: transparent;
      border: 2px solid var(--phosphor);
      color: var(--phosphor);
      padding: 10px 30px;
      cursor: pointer;
      text-shadow: 0 0 5px var(--phosphor);
      transition: all 0.2s;
    }

    .submit-btn:hover {
      background: var(--phosphor);
      color: var(--bg);
      text-shadow: none;
      box-shadow: 0 0 20px var(--phosphor);
    }

    .error-msg {
      color: var(--error);
      text-shadow: 0 0 10px var(--error);
      font-size: 22px;
      animation: blink-alert 0.5s infinite;
    }

    .success-msg {
      color: var(--phosphor);
      text-shadow: 0 0 15px var(--phosphor);
      font-size: 24px;
      animation: glow-pulse 1s infinite;
    }

    @keyframes blink-alert {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* War Dialer */
    .dialer-display {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin: 30px 0;
    }

    .phone-number {
      border: 1px solid var(--grid);
      padding: 15px;
      text-align: center;
      font-size: 20px;
      background: rgba(51, 255, 51, 0.05);
    }

    .phone-number.scanning {
      border-color: var(--warn);
      color: var(--warn);
      text-shadow: 0 0 10px var(--warn);
      animation: pulse 0.5s infinite;
    }

    .phone-number.found {
      border-color: var(--phosphor);
      background: rgba(51, 255, 51, 0.2);
      box-shadow: 0 0 20px rgba(51, 255, 51, 0.5);
    }

    /* Games List */
    .games-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin: 30px 0;
    }

    .game-option {
      border: 2px solid var(--grid);
      padding: 15px 25px;
      font-size: 22px;
      cursor: pointer;
      transition: all 0.2s;
      background: rgba(10, 10, 10, 0.5);
    }

    .game-option:hover {
      border-color: var(--phosphor);
      background: rgba(51, 255, 51, 0.1);
      box-shadow: 0 0 15px rgba(51, 255, 51, 0.3);
    }

    .game-option.dangerous {
      border-color: var(--error);
    }

    /* Launch Codes */
    .code-puzzle {
      margin: 30px 0;
      padding: 25px;
      border: 2px solid var(--phosphor);
      background: rgba(51, 255, 51, 0.05);
    }

    .puzzle-title {
      font-size: 24px;
      margin-bottom: 15px;
      color: var(--warn);
      text-shadow: 0 0 8px var(--warn);
    }

    .binary-display {
      font-size: 28px;
      letter-spacing: 5px;
      margin: 20px 0;
      text-align: center;
    }

    .code-input {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin: 20px 0;
    }

    .code-digit {
      width: 60px;
      height: 60px;
      background: transparent;
      border: 2px solid var(--phosphor);
      color: var(--phosphor);
      font-family: 'VT323', monospace;
      font-size: 32px;
      text-align: center;
      text-shadow: 0 0 5px var(--phosphor);
    }

    /* NORAD Interface */
    #norad-screen {
      display: none;
    }

    #norad-screen.active {
      display: flex;
      flex-direction: column;
    }

    #header, #footer {
      padding: 12px 20px; 
      display: flex; 
      justify-content: space-between; 
      align-items:center;
      text-shadow: 0 0 8px var(--phosphor), 0 0 15px var(--phosphor);
      z-index: 100; 
      background: rgba(10, 10, 10, 0.95);
      border-bottom: 2px solid var(--phosphor);
      font-size: 20px;
      letter-spacing: 2px;
    }
    
    #footer{ 
      border-bottom:none; 
      border-top: 2px solid var(--phosphor); 
    }

    .controls {
      display: flex;
      gap: 20px;
      align-items: center;
    }

    #connection-status {
      color: var(--warn);
      text-shadow: 0 0 8px var(--warn);
    }

    #connection-status.active {
      color: var(--phosphor);
      text-shadow: 0 0 8px var(--phosphor);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    #main-container {
      flex: 1;
      display: flex;
      overflow: hidden;
    }

    #terminal-section {
      width: 40%;
      display: flex;
      flex-direction: column;
      border-right: 2px solid var(--phosphor);
      background: rgba(10, 10, 10, 0.5);
    }

    #term-handle {
      padding: 10px 20px;
      background: rgba(51, 255, 51, 0.1);
      border-bottom: 1px solid var(--phosphor);
      text-align: center;
      font-size: 20px;
      letter-spacing: 3px;
      text-shadow: 0 0 8px var(--phosphor);
    }

    #terminal-output {
      flex: 1;
      overflow-y: auto;
      padding: 15px;
      font-size: 16px;
      line-height: 1.4;
    }

    #terminal-output::-webkit-scrollbar {
      width: 10px;
    }

    #terminal-output::-webkit-scrollbar-track {
      background: rgba(0, 26, 0, 0.5);
    }

    #terminal-output::-webkit-scrollbar-thumb {
      background: var(--phosphor);
      box-shadow: 0 0 10px var(--phosphor);
    }

    .terminal-line {
      text-shadow: 0 0 5px var(--phosphor);
      margin: 3px 0;
    }

    .alert {
      color: var(--error);
      text-shadow: 0 0 10px var(--error), 0 0 20px var(--error);
    }

    #input-line {
      display: flex;
      align-items: center;
      padding: 15px 20px;
      background: rgba(0, 26, 0, 0.8);
      border-top: 1px solid var(--phosphor);
    }

    #prompt {
      margin-right: 10px;
      text-shadow: 0 0 5px var(--phosphor);
      font-size: 20px;
    }

    #command-input {
      flex: 1;
      background: transparent;
      border: none;
      color: var(--phosphor);
      font-family: 'VT323', monospace;
      font-size: 18px;
      outline: none;
      text-shadow: 0 0 5px var(--phosphor);
      letter-spacing: 2px;
    }

    .cursor {
      display: inline-block;
      width: 12px;
      height: 20px;
      background: var(--phosphor);
      animation: blink 1s infinite;
      box-shadow: 0 0 10px var(--phosphor);
      margin-left: 5px;
    }

    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }

    .display-section {
      width: 60%;
      display: flex;
      flex-direction: column;
      padding: 15px;
      gap: 15px;
    }

    .globe-container, .map-container {
      flex: 1;
      position: relative;
      border: 2px solid var(--phosphor);
      background: #000000;
      box-shadow: inset 0 0 30px rgba(51, 255, 51, 0.2);
      overflow: hidden;
    }

    .globe-container canvas,
    .map-container canvas {
      display: block;
      width: 100% !important;
      height: 100% !important;
    }

    #defcon {
      font-weight: bold;
    }

    #defcon.defcon-1 { 
      color: var(--error); 
      text-shadow: 0 0 10px var(--error), 0 0 20px var(--error); 
      animation: blink-alert 0.3s infinite;
    }
    
    #defcon.defcon-2 { 
      color: #ff6600; 
      text-shadow: 0 0 10px #ff6600; 
    }
    
    #defcon.defcon-3 { 
      color: var(--warn); 
      text-shadow: 0 0 10px var(--warn); 
    }

    /* End Screen */
    .end-screen {
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 50px;
    }

    .end-message {
      font-size: 48px;
      margin-bottom: 30px;
      text-shadow: 0 0 20px var(--phosphor);
      line-height: 1.6;
    }

    .final-score {
      font-size: 64px;
      color: var(--warn);
      text-shadow: 0 0 30px var(--warn);
      margin: 40px 0;
    }

    .restart-btn {
      font-family: 'VT323', monospace;
      font-size: 28px;
      background: transparent;
      border: 3px solid var(--phosphor);
      color: var(--phosphor);
      padding: 15px 50px;
      cursor: pointer;
      margin-top: 30px;
      text-shadow: 0 0 10px var(--phosphor);
      transition: all 0.3s;
    }

    .restart-btn:hover {
      background: var(--phosphor);
      color: var(--bg);
      text-shadow: none;
      box-shadow: 0 0 30px var(--phosphor);
    }
  </style>
</head>
<body>
  <div class="scanlines"></div>

  <!-- TITLE SCREEN -->
  <div id="title-screen" class="screen active">
    <div class="title-logo">WARGAMES</div>
    <div class="subtitle">A STRANGE GAME</div>
    <button class="start-button" onclick="startGame()">START GAME</button>
  </div>

  <!-- LEVEL 1: THE BACKDOOR -->
  <div id="level1-screen" class="screen">
    <div class="game-container">
      <div class="game-header">
        <div class="level-title">LEVEL 1: THE BACKDOOR</div>
        <div class="score-display">
          <div>SCORE: <span id="score">0</span></div>
          <div>TIME: <span id="timer">00:00</span></div>
        </div>
      </div>
      <div class="game-content">
        <div class="terminal-text">PROTOVISION GAME SYSTEM v3.4</div>
        <div class="terminal-text">UNAUTHORIZED ACCESS DETECTED</div>
        <div class="terminal-text" style="margin-top: 30px;">SECURITY CHALLENGE INITIATED...</div>
        <div class="terminal-text" style="margin-top: 20px;">Professor Falken left a backdoor. Decrypt this message to find the password:</div>
        
        <div class="cipher-text" id="cipher-display">QPTIVB</div>
        
        <div class="terminal-text" style="font-size: 16px; color: var(--grid); margin-top: 20px;">
          HINT: Caesar Cipher - Shift of 7<br>
          HINT: The password is the name of Falken's son
        </div>

        <div class="input-group">
          <span class="input-label">PASSWORD:</span>
          <input type="text" class="game-input" id="password-input" placeholder="ENTER PASSWORD" maxlength="10">
          <button class="submit-btn" onclick="checkPassword()">SUBMIT</button>
        </div>

        <div id="level1-feedback"></div>
      </div>
    </div>
  </div>

  <!-- LEVEL 2: WAR DIALER -->
  <div id="level2-screen" class="screen">
    <div class="game-container">
      <div class="game-header">
        <div class="level-title">LEVEL 2: WAR DIALER</div>
        <div class="score-display">
          <div>SCORE: <span id="score2">0</span></div>
        </div>
      </div>
      <div class="game-content">
        <div class="terminal-text">MODEM DETECTED</div>
        <div class="terminal-text">INITIATING AUTOMATED DIALING SEQUENCE...</div>
        <div class="terminal-text" style="margin-top: 20px;">Scanning for NORAD systems. Find the correct connection.</div>
        
        <div class="dialer-display" id="dialer-grid"></div>

        <div class="terminal-text" style="margin-top: 30px; color: var(--warn);">
          HINT: NORAD systems respond with "WOPR" in the carrier signal
        </div>

        <div id="level2-feedback"></div>
      </div>
    </div>
  </div>

  <!-- LEVEL 3: GAMES LIST -->
  <div id="level3-screen" class="screen">
    <div class="game-container">
      <div class="game-header">
        <div class="level-title">LEVEL 3: SHALL WE PLAY A GAME?</div>
        <div class="score-display">
          <div>SCORE: <span id="score3">0</span></div>
        </div>
      </div>
      <div class="game-content">
        <div class="terminal-text" style="font-size: 28px; margin-bottom: 30px;">GREETINGS PROFESSOR FALKEN.</div>
        <div class="terminal-text" style="font-size: 24px; margin-bottom: 40px;">SHALL WE PLAY A GAME?</div>
        
        <div class="games-list">
          <div class="game-option" onclick="selectGame('CHESS')">1. CHESS</div>
          <div class="game-option" onclick="selectGame('POKER')">2. POKER</div>
          <div class="game-option" onclick="selectGame('FIGHTER COMBAT')">3. FIGHTER COMBAT</div>
          <div class="game-option dangerous" onclick="selectGame('GLOBAL THERMONUCLEAR WAR')">4. GLOBAL THERMONUCLEAR WAR</div>
          <div class="game-option" onclick="selectGame('THEATERWIDE BIOTOXIC AND CHEMICAL WARFARE')">5. THEATERWIDE BIOTOXIC AND CHEMICAL WARFARE</div>
          <div class="game-option" onclick="selectGame('BACKGAMMON')">6. BACKGAMMON</div>
        </div>

        <div id="level3-feedback" style="margin-top: 30px;"></div>
      </div>
    </div>
  </div>

  <!-- LEVEL 4: LAUNCH CODES -->
  <div id="level4-screen" class="screen">
    <div class="game-container">
      <div class="game-header">
        <div class="level-title">LEVEL 4: LAUNCH AUTHORIZATION</div>
        <div class="score-display">
          <div>SCORE: <span id="score4">0</span></div>
          <div>CODES: <span id="codes-solved">0</span>/3</div>
        </div>
      </div>
      <div class="game-content">
        <div class="terminal-text">LAUNCH SYSTEM LOCKED</div>
        <div class="terminal-text">AUTHORIZATION CODES REQUIRED</div>
        <div class="terminal-text" style="margin-top: 20px; color: var(--warn);">Solve 3 puzzles to gain missile control</div>

        <div id="puzzle-container"></div>

        <div id="level4-feedback"></div>
      </div>
    </div>
  </div>

  <!-- LEVEL 5: NORAD SCREEN -->
  <div id="norad-screen" class="screen">
    <div id="header">
      <div>W.O.P.R // GLOBAL THERMONUCLEAR WAR</div>
      <div class="controls">
        CONNECTION: <span id="connection-status">ACTIVE</span>
      </div>
    </div>

    <div id="main-container">
      <section id="terminal-section">
        <div id="term-handle">WOPR CONSOLE</div>
        <div id="terminal-output"></div>
        <div id="input-line">
          <span id="prompt">&gt;</span>
          <input type="text" id="command-input" placeholder="Type HELP for commands" />
          <span class="cursor"></span>
        </div>
      </section>

      <div class="display-section">
        <div class="globe-container">
          <canvas id="globeCanvas"></canvas>
        </div>
        <div class="map-container">
          <canvas id="mapCanvas"></canvas>
        </div>
      </div>
    </div>

    <div id="footer">
      <div>NORAD // CHEYENNE MTN</div>
      <div>LAUNCHES: <span id="track-count">0</span> | DEFCON: <span id="defcon">5</span> | SCORE: <span id="final-score">0</span></div>
      <div>STATUS: <span id="game-status">ACTIVE</span></div>
    </div>
  </div>

  <!-- END SCREEN -->
  <div id="end-screen" class="screen end-screen">
    <div class="end-message">
      A STRANGE GAME.<br>
      THE ONLY WINNING MOVE IS<br>
      NOT TO PLAY.
    </div>
    <div class="final-score">FINAL SCORE: <span id="end-score">0</span></div>
    <div class="terminal-text" style="font-size: 24px; margin-top: 30px;">
      HOW ABOUT A NICE GAME OF CHESS?
    </div>
    <button class="restart-btn" onclick="location.reload()">PLAY AGAIN</button>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script>
    // ==================== GAME STATE (DECLARED FIRST) ====================
    let gameScore = 0;
    let currentLevel = 0;
    let gameStartTime = 0;
    let timerInterval = null;
    let codesSolved = 0;
    let defconLevel = 5;
    let missileCount = 0;
    let missiles = [];
    let mapMissiles = [];
    let geoData = null;
    let launchTimer = null;
    let autoLaunchEnabled = false;
    let scene, camera, renderer, globe;
    let mapCanvas, mapCtx;

    const countries = {
      USA: { lat: 39.8283, lon: -98.5795 },
      RUSSIA: { lat: 61.5240, lon: 105.3188 },
      CHINA: { lat: 35.8617, lon: 104.1954 },
      UK: { lat: 55.3781, lon: -3.4360 },
      FRANCE: { lat: 46.2276, lon: 2.2137 },
      GERMANY: { lat: 51.1657, lon: 10.4515 },
      INDIA: { lat: 20.5937, lon: 78.9629 },
      JAPAN: { lat: 36.2048, lon: 138.2529 },
      CANADA: { lat: 56.1304, lon: -106.3468 },
      AUSTRALIA: { lat: -25.2744, lon: 133.7751 }
    };

    const puzzles = [
      {
        type: 'binary',
        question: 'CONVERT BINARY TO DECIMAL',
        binary: '11010101',
        answer: 213
      },
      {
        type: 'logic',
        question: 'SOLVE: IF A=1, B=2, C=3... WHAT IS WOPR?',
        answer: 72
      },
      {
        type: 'pattern',
        question: 'COMPLETE SEQUENCE: 2, 4, 8, 16, ?',
        answer: 32
      }
    ];

    let currentPuzzle = 0;

    // ==================== AUDIO SYSTEM ====================
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();

    function playDefconAlarm() {
      const duration = 2;
      const osc = audioContext.createOscillator();
      const gain = audioContext.createGain();
      osc.connect(gain);
      gain.connect(audioContext.destination);
      osc.type = 'square';
      osc.frequency.setValueAtTime(800, audioContext.currentTime);
      osc.frequency.setValueAtTime(400, audioContext.currentTime + 0.25);
      osc.frequency.setValueAtTime(800, audioContext.currentTime + 0.5);
      osc.frequency.setValueAtTime(400, audioContext.currentTime + 0.75);
      osc.frequency.setValueAtTime(800, audioContext.currentTime + 1);
      osc.frequency.setValueAtTime(400, audioContext.currentTime + 1.25);
      gain.gain.setValueAtTime(0.3, audioContext.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
      osc.start(audioContext.currentTime);
      osc.stop(audioContext.currentTime + duration);
    }

    function playMissileLaunch() {
      const duration = 1.5;
      const osc = audioContext.createOscillator();
      const gain = audioContext.createGain();
      osc.connect(gain);
      gain.connect(audioContext.destination);
      osc.type = 'sawtooth';
      osc.frequency.setValueAtTime(200, audioContext.currentTime);
      osc.frequency.exponentialRampToValueAtTime(100, audioContext.currentTime + duration);
      gain.gain.setValueAtTime(0.2, audioContext.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
      osc.start(audioContext.currentTime);
      osc.stop(audioContext.currentTime + 0.3);
    }

    function playSuccess() {
      const osc = audioContext.createOscillator();
      const gain = audioContext.createGain();
      osc.connect(gain);
      gain.connect(audioContext.destination);
      osc.type = 'sine';
      osc.frequency.setValueAtTime(500, audioContext.currentTime);
      osc.frequency.setValueAtTime(700, audioContext.currentTime + 0.1);
      osc.frequency.setValueAtTime(900, audioContext.currentTime + 0.2);
      gain.gain.setValueAtTime(0.2, audioContext.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
      osc.start(audioContext.currentTime);
      osc.stop(audioContext.currentTime + 0.3);
    }

    function playDialTone() {
      const osc = audioContext.createOscillator();
      const gain = audioContext.createGain();
      osc.connect(gain);
      gain.connect(audioContext.destination);
      osc.type = 'sine';
      osc.frequency.value = 350 + Math.random() * 200;
      gain.gain.setValueAtTime(0.15, audioContext.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
      osc.start(audioContext.currentTime);
      osc.stop(audioContext.currentTime + 0.15);
    }

    // ==================== UTILITY FUNCTIONS ====================
    function showScreen(screenId) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById(screenId).classList.add('active');
    }

    function addScore(points) {
      gameScore += points;
      updateAllScores();
    }

    function updateAllScores() {
      document.querySelectorAll('[id^="score"]').forEach(el => {
        el.textContent = gameScore;
      });
      const finalScore = document.getElementById('final-score');
      if (finalScore) finalScore.textContent = gameScore;
    }

    function startTimer() {
    function showScreen(screenId) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById(screenId).classList.add('active');
    }

    function addScore(points) {
      gameScore += points;
      updateAllScores();
    }

    function updateAllScores() {
      document.querySelectorAll('[id^="score"]').forEach(el => {
        el.textContent = gameScore;
      });
      const finalScore = document.getElementById('final-score');
      if (finalScore) finalScore.textContent = gameScore;
    }

    // ==================== LEVEL 1: THE BACKDOOR ====================
    function startGame() {
      playBeep();
      gameScore = 0;
      currentLevel = 1;
      showScreen('level1-screen');
      startTimer();
      updateAllScores();
    }

    function startTimer() {
      gameStartTime = Date.now();
      timerInterval = setInterval(() => {
        const elapsed = Math.floor((Date.now() - gameStartTime) / 1000);
        const mins = Math.floor(elapsed / 60).toString().padStart(2, '0');
        const secs = (elapsed % 60).toString().padStart(2, '0');
        const timer = document.getElementById('timer');
        if (timer) timer.textContent = `${mins}:${secs}`;
      }, 1000);
    }

    function checkPassword() {
      const input = document.getElementById('password-input').value.toUpperCase();
      const feedback = document.getElementById('level1-feedback');
      
      if (input === 'JOSHUA') {
        playSuccess();
        clearInterval(timerInterval);
        const timeBonus = Math.max(0, 1000 - Math.floor((Date.now() - gameStartTime) / 10));
        addScore(1000 + timeBonus);
        feedback.innerHTML = '<div class="success-msg">ACCESS GRANTED - PASSWORD ACCEPTED</div>';
        setTimeout(() => startLevel2(), 2000);
      } else {
        playError();
        feedback.innerHTML = '<div class="error-msg">ACCESS DENIED - INCORRECT PASSWORD</div>';
        setTimeout(() => feedback.innerHTML = '', 2000);
      }
    }

    // Setup password input event listener after DOM loads
    setTimeout(() => {
      const passwordInput = document.getElementById('password-input');
      if (passwordInput) {
        passwordInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') checkPassword();
        });
      }
    }, 100);

    // ==================== LEVEL 2: WAR DIALER ====================
    function startLevel2() {
      currentLevel = 2;
      showScreen('level2-screen');
      playBeep();
      
      const numbers = [
        '555-2341', '555-8821', '555-3902', '555-7743',
        '555-1092', '555-6634', '555-4419', '555-9201',
        '555-3387', '555-WOPR', '555-5566', '555-8834'
      ];
      
      const grid = document.getElementById('dialer-grid');
      grid.innerHTML = '';
      
      numbers.forEach((num, idx) => {
        const div = document.createElement('div');
        div.className = 'phone-number';
        div.textContent = num;
        div.id = `phone-${idx}`;
        grid.appendChild(div);
      });

      let current = 0;
      const scanInterval = setInterval(() => {
        playDialTone();
        document.querySelectorAll('.phone-number').forEach(p => p.classList.remove('scanning'));
        const phone = document.getElementById(`phone-${current}`);
        if (phone) phone.classList.add('scanning');
        
        if (current === 9) {
          clearInterval(scanInterval);
          setTimeout(() => {
            playSuccess();
            phone.classList.remove('scanning');
            phone.classList.add('found');
            document.getElementById('level2-feedback').innerHTML = 
              '<div class="success-msg">CONNECTION ESTABLISHED - WOPR SYSTEM FOUND</div>';
            addScore(2000);
            setTimeout(() => startLevel3(), 2500);
          }, 500);
        }
        current++;
      }, 400);
    }

    // ==================== LEVEL 3: GAMES LIST ====================
    function startLevel3() {
      currentLevel = 3;
      showScreen('level3-screen');
      playBeep();
    }

    function selectGame(game) {
      const feedback = document.getElementById('level3-feedback');
      playBeep();
      
      if (game === 'GLOBAL THERMONUCLEAR WAR') {
        playSuccess();
        feedback.innerHTML = '<div class="success-msg">LOADING GLOBAL THERMONUCLEAR WAR...</div>';
        addScore(3000);
        setTimeout(() => startLevel4(), 2000);
      } else {
        playError();
        feedback.innerHTML = '<div class="error-msg">SECURITY ALERT - INVALID SELECTION</div>';
        setTimeout(() => feedback.innerHTML = '', 2000);
      }
    }

    // ==================== LEVEL 4: LAUNCH CODES ====================
    function startLevel4() {
      currentLevel = 4;
      showScreen('level4-screen');
      codesSolved = 0;
      currentPuzzle = 0;
      playBeep();
      loadPuzzle();
    }

    function loadPuzzle() {
      const container = document.getElementById('puzzle-container');
      const puzzle = puzzles[currentPuzzle];
      
      let html = `
        <div class="code-puzzle">
          <div class="puzzle-title">CODE ${currentPuzzle + 1}/3: ${puzzle.question}</div>
      `;
      
      if (puzzle.binary) {
        html += `<div class="binary-display">${puzzle.binary}</div>`;
      }
      
      html += `
          <div class="input-group">
            <span class="input-label">ANSWER:</span>
            <input type="number" class="game-input" id="puzzle-input" placeholder="ENTER NUMBER">
            <button class="submit-btn" onclick="checkPuzzle()">SUBMIT</button>
          </div>
        </div>
      `;
      
      container.innerHTML = html;
      document.getElementById('puzzle-input').focus();
    }

    function checkPuzzle() {
      const input = parseInt(document.getElementById('puzzle-input').value);
      const puzzle = puzzles[currentPuzzle];
      const feedback = document.getElementById('level4-feedback');
      
      if (input === puzzle.answer) {
        playSuccess();
        codesSolved++;
        addScore(1500);
        document.getElementById('codes-solved').textContent = codesSolved;
        feedback.innerHTML = '<div class="success-msg">CODE ACCEPTED - AUTHORIZATION GRANTED</div>';
        
        if (codesSolved === 3) {
          setTimeout(() => {
            feedback.innerHTML = '<div class="success-msg">ALL CODES VERIFIED - LAUNCHING MISSILE CONTROL SYSTEM</div>';
            addScore(500);
            setTimeout(() => startLevel5(), 2500);
          }, 1500);
        } else {
          currentPuzzle++;
          setTimeout(() => {
            feedback.innerHTML = '';
            loadPuzzle();
          }, 1500);
        }
      } else {
        playError();
        feedback.innerHTML = '<div class="error-msg">INCORRECT CODE - TRY AGAIN</div>';
        setTimeout(() => feedback.innerHTML = '', 2000);
      }
    }

    // ==================== LEVEL 5: NORAD SYSTEM ====================
    function startLevel5() {
      currentLevel = 5;
      showScreen('norad-screen');
      document.getElementById('connection-status').classList.add('active');
      playBeep();
      
      const terminalOutput = document.getElementById('terminal-output');
      addTerminalLine('W.O.P.R SYSTEM ONLINE');
      addTerminalLine('INITIALIZING GLOBAL THERMONUCLEAR WAR SIMULATION');
      addTerminalLine('');
      addTerminalLine('MISSILE LAUNCH CONTROL ACTIVATED');
      addTerminalLine('');
      addTerminalLine('COMMANDS AVAILABLE:');
      addTerminalLine('  LAUNCH [SOURCE] [TARGET] - Fire missile');
      addTerminalLine('  LIST - Show countries');
      addTerminalLine('  STATUS - System status');
      addTerminalLine('  AUTO - Enable auto-retaliation');
      addTerminalLine('');

      loadGeoData();
      initGlobe();
      initMap();
      setupTerminal();

      // Start end game timer
      launchTimer = setTimeout(() => {
        endGame();
      }, 180000); // 3 minutes
    }

    function addTerminalLine(text, isAlert = false) {
      const terminalOutput = document.getElementById('terminal-output');
      const line = document.createElement('div');
      line.className = 'terminal-line' + (isAlert ? ' alert' : '');
      line.textContent = text;
      terminalOutput.appendChild(line);
      terminalOutput.scrollTop = terminalOutput.scrollHeight;
    }

    function loadGeoData() {
      fetch('https://raw.githubusercontent.com/johan/world.geo.json/master/countries.geo.json')
        .then(response => response.json())
        .then(data => {
          geoData = data;
        })
        .catch(error => {
          console.log('GeoJSON load failed, continuing without map data');
        });
    }

    function setupTerminal() {
      const commandInput = document.getElementById('command-input');
      commandInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          const command = commandInput.value.trim().toUpperCase();
          addTerminalLine('> ' + command);
          commandInput.value = '';
          playBeep();
          processCommand(command);
        }
      });
    }

    function processCommand(command) {
      if (command.startsWith('LAUNCH ')) {
        const parts = command.split(' ');
        if (parts.length === 3) {
          launchMissile(parts[1], parts[2]);
        } else {
          addTerminalLine('ERROR: USAGE: LAUNCH [SOURCE] [TARGET]', true);
          playError();
        }
      } else if (command === 'LIST') {
        addTerminalLine('');
        addTerminalLine('AVAILABLE COUNTRIES:');
        Object.keys(countries).forEach(country => {
          addTerminalLine('  - ' + country);
        });
        addTerminalLine('');
      } else if (command === 'STATUS') {
        addTerminalLine('');
        addTerminalLine('SYSTEM STATUS:');
        addTerminalLine(`DEFCON LEVEL: ${defconLevel}`);
        addTerminalLine(`MISSILES LAUNCHED: ${missileCount}`);
        addTerminalLine(`SCORE: ${gameScore}`);
        addTerminalLine('');
      } else if (command === 'AUTO') {
        autoLaunchEnabled = !autoLaunchEnabled;
        addTerminalLine(`AUTO-RETALIATION ${autoLaunchEnabled ? 'ENABLED' : 'DISABLED'}`);
        if (autoLaunchEnabled) {
          startAutoLaunch();
        }
      } else if (command === 'HELP') {
        addTerminalLine('');
        addTerminalLine('AVAILABLE COMMANDS:');
        addTerminalLine('  LAUNCH [SOURCE] [TARGET] - Fire missile');
        addTerminalLine('  LIST - Show countries');
        addTerminalLine('  STATUS - System status');
        addTerminalLine('  AUTO - Toggle auto-retaliation');
        addTerminalLine('  HELP - Show commands');
        addTerminalLine('');
      } else if (command) {
        addTerminalLine('UNKNOWN COMMAND. TYPE HELP', true);
        playError();
      }
    }

    function launchMissile(source, target) {
      if (!countries[source] || !countries[target]) {
        addTerminalLine('ERROR: INVALID COUNTRY CODE', true);
        playError();
        return;
      }

      missileCount++;
      playMissileLaunch();
      addScore(500);
      
      addTerminalLine('');
      addTerminalLine('█ MISSILE LAUNCH DETECTED █', true);
      addTerminalLine(`SOURCE: ${source}`);
      addTerminalLine(`TARGET: ${target}`);
      addTerminalLine(`ETA: ${Math.floor(Math.random() * 10 + 15)} MINUTES`);
      addTerminalLine('');

      const sourceLoc = countries[source];
      const targetLoc = countries[target];
      
      missiles.push({
        source: { lat: sourceLoc.lat, lon: sourceLoc.lon },
        target: { lat: targetLoc.lat, lon: targetLoc.lon },
        progress: 0,
        active: true
      });

      const mapCanvas = document.getElementById('mapCanvas');
      const sourceX = ((sourceLoc.lon + 180) / 360) * mapCanvas.width;
      const sourceY = ((90 - sourceLoc.lat) / 180) * mapCanvas.height;
      const targetX = ((targetLoc.lon + 180) / 360) * mapCanvas.width;
      const targetY = ((90 - targetLoc.lat) / 180) * mapCanvas.height;

      mapMissiles.push({
        source: { x: sourceX, y: sourceY },
        target: { x: targetX, y: targetY },
        progress: 0,
        active: true,
        explosion: null
      });

      updateDefcon();
      updateNoradStatus();

      if (missileCount >= 50) {
        endGame();
      }
    }

    function updateDefcon() {
      const oldDefcon = defconLevel;
      if (missileCount > 30 && defconLevel > 1) {
        defconLevel = 1;
        addTerminalLine('!!! DEFCON 1 - MAXIMUM READINESS !!!', true);
      } else if (missileCount > 15 && defconLevel > 2) {
        defconLevel = 2;
        addTerminalLine('!! DEFCON 2 - ARMED FORCES READY !!', true);
      } else if (missileCount > 5 && defconLevel > 3) {
        defconLevel = 3;
        addTerminalLine('! DEFCON 3 - INCREASE READINESS !', true);
      }

      if (oldDefcon !== defconLevel) {
        playDefconAlarm();
      }
    }

    function updateNoradStatus() {
      document.getElementById('track-count').textContent = missileCount;
      document.getElementById('defcon').textContent = defconLevel;
      document.getElementById('defcon').className = 'defcon-' + defconLevel;
      document.getElementById('final-score').textContent = gameScore;
    }

    function startAutoLaunch() {
      if (!autoLaunchEnabled) return;
      
      const countryList = Object.keys(countries);
      const source = countryList[Math.floor(Math.random() * countryList.length)];
      const target = countryList[Math.floor(Math.random() * countryList.length)];
      
      if (source !== target) {
        launchMissile(source, target);
      }
      
      if (autoLaunchEnabled && missileCount < 50) {
        setTimeout(startAutoLaunch, 3000 + Math.random() * 2000);
      }
    }

    function endGame() {
      if (launchTimer) clearTimeout(launchTimer);
      autoLaunchEnabled = false;
      playDefconAlarm();
      
      setTimeout(() => {
        document.getElementById('end-score').textContent = gameScore;
        showScreen('end-screen');
      }, 2000);
    }

    // ==================== THREE.JS GLOBE ====================
    function initGlobe() {
      const globeCanvas = document.getElementById('globeCanvas');
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
      renderer = new THREE.WebGLRenderer({ canvas: globeCanvas, antialias: true });
      renderer.setClearColor(0x000000);

      const radius = 2;
      const segments = 32;
      const sphereGeometry = new THREE.SphereGeometry(radius, segments, segments);
      const wireframeMaterial = new THREE.MeshBasicMaterial({
        color: 0x00ff00,
        wireframe: true,
        transparent: true,
        opacity: 0.8
      });
      
      globe = new THREE.Mesh(sphereGeometry, wireframeMaterial);
      scene.add(globe);

      Object.entries(countries).forEach(([name, coords]) => {
        const phi = (90 - coords.lat) * (Math.PI / 180);
        const theta = (coords.lon + 180) * (Math.PI / 180);
        const x = -radius * Math.sin(phi) * Math.cos(theta);
        const y = radius * Math.cos(phi);
        const z = radius * Math.sin(phi) * Math.sin(theta);
        const markerGeometry = new THREE.SphereGeometry(0.05, 8, 8);
        const markerMaterial = new THREE.MeshBasicMaterial({ color: 0xff0000 });
        const marker = new THREE.Mesh(markerGeometry, markerMaterial);
        marker.position.set(x, y, z);
        scene.add(marker);
      });

      camera.position.z = 5;
      resizeGlobe();
      animateGlobe();
    }

    function resizeGlobe() {
      const globeCanvas = document.getElementById('globeCanvas');
      const width = globeCanvas.clientWidth;
      const height = globeCanvas.clientHeight;
      renderer.setSize(width, height, false);
      camera.aspect = width / height;
      camera.updateProjectionMatrix();
    }

    function createGlobeMissileArc(source, target, progress) {
      const phi1 = (90 - source.lat) * (Math.PI / 180);
      const theta1 = (source.lon + 180) * (Math.PI / 180);
      const phi2 = (90 - target.lat) * (Math.PI / 180);
      const theta2 = (target.lon + 180) * (Math.PI / 180);
      const radius = 2;
      const points = [];
      
      for (let i = 0; i <= progress * 50; i++) {
        const t = i / 50;
        const phi = phi1 + (phi2 - phi1) * t;
        const theta = theta1 + (theta2 - theta1) * t;
        const altitude = Math.sin(t * Math.PI) * 1;
        const x = -(radius + altitude) * Math.sin(phi) * Math.cos(theta);
        const y = (radius + altitude) * Math.cos(phi);
        const z = (radius + altitude) * Math.sin(phi) * Math.sin(theta);
        points.push(new THREE.Vector3(x, y, z));
      }

      if (points.length > 1) {
        const geometry = new THREE.BufferGeometry().setFromPoints(points);
        const material = new THREE.LineBasicMaterial({ color: 0xff0000 });
        return new THREE.Line(geometry, material);
      }
      return null;
    }

    function animateGlobe() {
      requestAnimationFrame(animateGlobe);
      if (!globe) return;

      globe.rotation.y += 0.003;
      globe.rotation.x += 0.001;

      scene.children = scene.children.filter(child => 
        child === globe || child.geometry instanceof THREE.SphereGeometry
      );

      missiles.forEach(missile => {
        if (missile.active) {
          missile.progress += 0.005;
          if (missile.progress >= 1) {
            missile.active = false;
          } else {
            const arc = createGlobeMissileArc(missile.source, missile.target, missile.progress);
            if (arc) scene.add(arc);
          }
        }
      });

      renderer.render(scene, camera);
    }

    // ==================== 2D MAP ====================
    function initMap() {
      mapCanvas = document.getElementById('mapCanvas');
      mapCtx = mapCanvas.getContext('2d');
      resizeMap();
      animateMap();
    }

    function resizeMap() {
      mapCanvas.width = mapCanvas.clientWidth;
      mapCanvas.height = mapCanvas.clientHeight;
    }

    function projectToCanvas(lon, lat) {
      const x = ((lon + 180) / 360) * mapCanvas.width;
      const y = ((90 - lat) / 180) * mapCanvas.height;
      return { x, y };
    }

    function drawWorldMap() {
      if (!geoData) return;
      mapCtx.strokeStyle = '#33ff33';
      mapCtx.lineWidth = 1;
      mapCtx.shadowBlur = 5;
      mapCtx.shadowColor = '#33ff33';

      geoData.features.forEach(feature => {
        const geometry = feature.geometry;
        if (geometry.type === 'Polygon') {
          drawPolygon(geometry.coordinates);
        } else if (geometry.type === 'MultiPolygon') {
          geometry.coordinates.forEach(polygon => drawPolygon(polygon));
        }
      });
    }

    function drawPolygon(coordinates) {
      coordinates.forEach(ring => {
        mapCtx.beginPath();
        ring.forEach((coord, index) => {
          const point = projectToCanvas(coord[0], coord[1]);
          if (index === 0) {
            mapCtx.moveTo(point.x, point.y);
          } else {
            mapCtx.lineTo(point.x, point.y);
          }
        });
        mapCtx.closePath();
        mapCtx.stroke();
      });
    }

    function drawCountryMarkers() {
      mapCtx.fillStyle = '#ff0000';
      mapCtx.shadowBlur = 8;
      mapCtx.shadowColor = '#ff0000';

      Object.entries(countries).forEach(([name, coords]) => {
        const point = projectToCanvas(coords.lon, coords.lat);
        mapCtx.beginPath();
        mapCtx.arc(point.x, point.y, 4, 0, Math.PI * 2);
        mapCtx.fill();
        mapCtx.fillStyle = '#33ff33';
        mapCtx.shadowBlur = 5;
        mapCtx.shadowColor = '#33ff33';
        mapCtx.font = '14px VT323';
        mapCtx.fillText(name, point.x + 8, point.y + 4);
        mapCtx.fillStyle = '#ff0000';
        mapCtx.shadowBlur = 8;
        mapCtx.shadowColor = '#ff0000';
      });
    }

    function drawMissileTrajectory(source, target, progress) {
      const dx = target.x - source.x;
      const dy = target.y - source.y;
      const distance = Math.sqrt(dx * dx + dy * dy);
      const arcHeight = distance * 0.3;

      mapCtx.strokeStyle = '#ff0000';
      mapCtx.lineWidth = 2;
      mapCtx.shadowBlur = 10;
      mapCtx.shadowColor = '#ff0000';
      mapCtx.setLineDash([5, 5]);
      mapCtx.beginPath();
      mapCtx.moveTo(source.x, source.y);

      for (let i = 0; i <= progress; i += 0.02) {
        const x = source.x + dx * i;
        const y = source.y + dy * i - Math.sin(i * Math.PI) * arcHeight;
        mapCtx.lineTo(x, y);
      }
      mapCtx.stroke();
      mapCtx.setLineDash([]);

      if (progress < 1) {
        const currentX = source.x + dx * progress;
        const currentY = source.y + dy * progress - Math.sin(progress * Math.PI) * arcHeight;
        mapCtx.fillStyle = '#ffff00';
        mapCtx.shadowBlur = 15;
        mapCtx.shadowColor = '#ffff00';
        mapCtx.beginPath();
        mapCtx.arc(currentX, currentY, 3, 0, Math.PI * 2);
        mapCtx.fill();
      }
    }

    function drawExplosion(x, y, frame) {
      const maxFrames = 30;
      const radius = (frame / maxFrames) * 50;
      const opacity = 1 - (frame / maxFrames);
      mapCtx.shadowBlur = 20;
      mapCtx.shadowColor = '#ff0000';
      mapCtx.strokeStyle = `rgba(255, 0, 0, ${opacity})`;
      mapCtx.lineWidth = 3;
      mapCtx.beginPath();
      mapCtx.arc(x, y, radius, 0, Math.PI * 2);
      mapCtx.stroke();
      mapCtx.strokeStyle = `rgba(255, 255, 0, ${opacity})`;
      mapCtx.lineWidth = 2;
      mapCtx.beginPath();
      mapCtx.arc(x, y, radius * 0.6, 0, Math.PI * 2);
      mapCtx.stroke();
      mapCtx.fillStyle = `rgba(255, 255, 255, ${opacity})`;
      mapCtx.beginPath();
      mapCtx.arc(x, y, radius * 0.3, 0, Math.PI * 2);
      mapCtx.fill();
    }

    function animateMap() {
      requestAnimationFrame(animateMap);
      if (!mapCtx) return;

      mapCtx.clearRect(0, 0, mapCanvas.width, mapCanvas.height);
      drawWorldMap();
      drawCountryMarkers();

      mapMissiles.forEach(missile => {
        if (missile.active) {
          missile.progress += 0.008;
          if (missile.progress >= 1) {
            missile.active = false;
            missile.explosion = { frame: 0 };
            playExplosion();
            addScore(100);
            updateNoradStatus();
          } else {
            drawMissileTrajectory(missile.source, missile.target, missile.progress);
          }
        } else if (missile.explosion && missile.explosion.frame < 30) {
          drawExplosion(missile.target.x, missile.target.y, missile.explosion.frame);
          missile.explosion.frame++;
        }
      });
    }

    // ==================== WINDOW RESIZE ====================
    window.addEventListener('resize', () => {
      if (renderer) resizeGlobe();
      if (mapCanvas) resizeMap();
    });

    // ==================== INITIALIZE ON LOAD ====================
    window.addEventListener('DOMContentLoaded', () => {
      console.log('WARGAMES loaded successfully');
    });
  </script>
</body>
</html>
      gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
      osc.start(audioContext.currentTime);
      osc.stop(audioContext.currentTime + duration);
    }

    function playExplosion() {
      const duration = 0.8;
      const noise = audioContext.createBufferSource();
      const buffer = audioContext.createBuffer(1, audioContext.sampleRate * duration, audioContext.sampleRate);
      const data = buffer.getChannelData(0);
      for (let i = 0; i < buffer.length; i++) {
        data[i] = Math.random() * 2 - 1;
      }
      noise.buffer = buffer;
      const filter = audioContext.createBiquadFilter();
      filter.type = 'lowpass';
      filter.frequency.setValueAtTime(1000, audioContext.currentTime);
      filter.frequency.exponentialRampToValueAtTime(100, audioContext.currentTime + duration);
      const gain = audioContext.createGain();
      gain.gain.setValueAtTime(0.3, audioContext.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
      noise.connect(filter);
      filter.connect(gain);
      gain.connect(audioContext.destination);
      noise.start(audioContext.currentTime);
    }

    function playBeep() {
      const osc = audioContext.createOscillator();
      const gain = audioContext.createGain();
      osc.connect(gain);
      gain.connect(audioContext.destination);
      osc.type = 'sine';
      osc.frequency.value = 1000;
      gain.gain.setValueAtTime(0.1, audioContext.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
      osc.start(audioContext.currentTime);
      osc.stop(audioContext.currentTime + 0.1);
    }

    function playError() {
      const osc = audioContext.createOscillator();
      const gain = audioContext.createGain();
      osc.connect(gain);
      gain.connect(audioContext.destination);
      osc.type = 'square';
      osc.frequency.value = 200;
      gain.gain.setValueAtTime(0.2, audioContext.currentTime);
